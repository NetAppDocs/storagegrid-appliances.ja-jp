---
permalink: sg5800/replace-controller-e4000-simplex.html 
sidebar: sidebar 
keywords: storagegrid, sg5800, storage node, storage appliance, Replacing, replace, e4000, controller, remove, removing, removal, install, installing, installation 
summary: E4000コントローラが適切に機能しない場合や障害が発生した場合は、交換が必要になることがあります。 
---
= E4000コントローラの交換（SG5800）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
E4000コントローラが適切に機能しない場合や障害が発生した場合は、交換が必要になることがあります。

.作業を開始する前に
次のものがあることを確認します。

* 交換するコントローラと同じパーツ番号の交換用コントローラ。
+

NOTE: StorageGRID アプライアンスのコントローラを交換する際は、Eシリーズの手順書を参考にしないでください。手順が異なります。

* ESDリストバンドを装着するか、静電気防止処置を施しておきます。
* コントローラに接続されている各ケーブルを識別するためのラベル。
* 特定のアクセス権限。
* を使用して Grid Manager にサインインする必要があります https://docs.netapp.com/us-en/storagegrid-118/admin/web-browser-requirements.html["サポートされている Web ブラウザ"^]。
* SANtricityシステムマネージャへのアクセス：
+
** Grid Managerで、* nodes *>*_appliance node_*>* SANtricity System Manager *を選択します。コントローラ情報は https://docs.netapp.com/us-en/storagegrid-118/monitor/viewing-santricity-system-manager-tab.html["SANtricityの[System Manager]タブ"]。
** 管理ステーションのブラウザで、コントローラのドメイン名またはIPアドレスを指定します。




.このタスクについて
コントローラキャニスターに障害が発生したかどうかは、次の 2 つの方法で確認できます。

* Grid Managerのアラートでストレージコントローラの障害が通知され、SANtricity System ManagerのGrid ManagerまたはRecovery Guruからコントローラの交換を指示されます。
* コントローラの黄色の警告 LED が点灯して、コントローラに障害が発生したことが通知されます。


コントローラを交換すると、アプライアンスストレージノードにアクセスできなくなります。E4000シリーズコントローラが十分に機能している場合は、次の操作を実行できます。 link:../commonhardware/placing-appliance-into-maintenance-mode.html["SG5800アプライアンスをメンテナンスモードにする"]。



== 手順 1 ：コントローラを交換する準備をします

コントローラキャニスターを交換する準備として、ドライブセキュリティキーを保存し、構成をバックアップし、サポートデータを収集します。そのあと、ホスト I/O 処理を停止し、コントローラシェルフの電源をオフにすることができます。

.手順
. 可能であれば、コントローラに現在インストールされている SANtricity OS ソフトウェアのバージョンをメモしておいてください。SANtricityシステムマネージャを開き、*サポート›アップグレードセンター›ソフトウェアとファームウェアのインベントリの表示*を選択します。
. 現在インストールされているNVSRAMのバージョンをメモします。
. ドライブセキュリティ機能が有効になっている場合は、保存されたキーが存在すること、およびそのインストールに必要なパスフレーズを確認しておきます。
+

CAUTION: *データアクセスが失われる可能性*—ストレージアレイ内のすべてのドライブでセキュリティが有効になっている場合、CLIを使用してセキュリティ保護されたドライブのロックを解除するまで、新しいコントローラはストレージアレイにアクセスできません。CLIの詳細については、を参照してください。 https://docs.netapp.com/us-en/e-series-cli/index.html["Eシリーズのドキュメント"]。

+
キーを保存する手順は次のとおりです（コントローラの状態によっては実行できない場合があります）。

+
.. SANtricityシステムマネージャで、*[設定]>[システム]を選択します。
.. ドライブセキュリティキー管理 * で、 * バックアップキー * を選択します。
.. [ * パスフレーズを定義 / パスフレーズを再入力 * ] フィールドに、このバックアップコピーのパスフレーズを入力して確認します。
.. [ バックアップ ] をクリックします。
.. 安全な場所にキー情報を記録し、 [*Close*] をクリックします。


. SANtricity システムマネージャを使用して、ストレージアレイの構成データベースをバックアップします。
+
コントローラを取り外すときに問題が発生した場合は、保存したファイルを使用して構成をリストアできます。RAID 構成データベースの現在の状態が保存されます。これには、コントローラ上のボリュームグループとディスクプールのすべてのデータが含まれます。

+
** System Manager から：
+
... *サポート›サポートセンター›診断*を選択します。
... [ 構成データの収集 *] を選択します。
... [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * configurationdata-<ArrayName>-<dateTime >.7z * 」という名前でファイルが保存されます。



** または、次の CLI コマンドを使用して構成データベースをバックアップすることもできます。
+
`save storageArray dbmDatabase sourceLocation=onboard contentType=all file="filename";`



. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
コントローラの取り外し時に問題が発生した場合は、保存したファイルを使用して問題のトラブルシューティングを行うことができます。ストレージアレイに関するインベントリ、ステータス、およびパフォーマンスデータが 1 つのファイルに保存されます。

+
.. *サポート›サポートセンター›診断*を選択します。
.. 「サポートデータの収集」を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。







== 手順2：コントローラをオフラインにする

コントローラをオフラインにし、すべての処理が完了したことを確認します。

.手順
. StorageGRID アプライアンスを StorageGRID システムで実行している場合は、 link:../commonhardware/placing-appliance-into-maintenance-mode.html["アプライアンスをメンテナンスモードにする"]。
. E4000コントローラが正常に機能していて、通常の方法でシャットダウンできる場合は、すべての操作が完了していることを確認します。
+
.. キャッシュメモリ内のデータがドライブに書き込まれるまで待ちます。
+
キャッシュされたデータをドライブに書き込む必要がある場合は、コントローラの背面にある緑のキャッシュアクティブ LED が点灯します。この LED が消灯するまで待つ必要があります。

.. SANtricity システムマネージャのホームページで、「 * 進行中の処理を表示」を選択します。
.. すべての処理が完了したことを確認してから、次の手順に進みます。


. コントローラシェルフの両方の電源スイッチをオフにします。
. コントローラシェルフのすべての LED が消灯するまで待ちます。




== 手順3：E4000コントローラキャニスターを取り外す

E4000コントローラキャニスターを取り外します。

.手順
. ESD リストバンドを装着するか、静電気防止処置を施します。
. コントローラキャニスターに接続された各ケーブルにラベルを付けます。
. コントローラキャニスターからすべてのケーブルを外します。
+

CAUTION: パフォーマンスの低下を防ぐために、ケーブルをねじったり、折り曲げたり、はさんだり、踏みつけたりしないでください。

. カムハンドルのラッチを外れるまで押し、カムハンドルをいっぱいまで開いてコントローラキャニスターをミッドプレーンから外し、両手でコントローラキャニスターをシャーシから引き出します。
. 取り外し可能なカバーを上にして、静電気防止処置を施した平らな場所にコントローラを置きます。
. コントローラキャニスターの側面にある青いボタンを押してカバーを開き、カバーを上に回転させてコントローラキャニスターから取り外します。




== 手順4：交換用コントローラに転送するパーツを特定する

交換用コントローラにはパーツがあらかじめ取り付けられている場合があります。交換用コントローラキャニスターに移す必要があるパーツを特定します。

. 取り外し可能なカバーを上にして、交換用コントローラを静電気防止処置を施した平らな場所に置きます。
. コントローラキャニスターの側面にある青いボタンを押してカバーを開き、カバーを上に回転させてコントローラキャニスターから取り外します。
. 交換用コントローラにバッテリ/ DIMMが搭載されているかどうかを確認します。表示される場合は、コントローラのカバーを再度取り付け、に進みます。 <<step8_replace_controller,手順8：コントローラを交換する>>。それ以外の場合：
+
** 交換用コントローラにバッテリまたはDIMMが搭載されていない場合は、に進みます。 <<step5_remove_battery,手順5：バッテリを取り外す>>。
** 交換用コントローラにバッテリが搭載されていてDIMMが搭載されていない場合は、に進みます。 <<step6_remove_dimm,手順6：DIMMを移動する>>。






== 手順5：バッテリを取り外す

障害のあるコントローラからバッテリを取り外し、交換用コントローラに取り付けます。

.手順
. コントローラキャニスターからバッテリを取り外します。
+
.. コントローラキャニスターの側面にある青いボタンを押します。
.. 保持ブラケットからバッテリを上にスライドさせ、持ち上げてコントローラキャニスターから取り出します。
.. バッテリプラグ前面のクリップを押してプラグをソケットから外し、バッテリケーブルをソケットから抜きます。
+
image::../media/drw_E4000_replace_nvbattery_IEOPS-862.png[NVMEMバッテリを取り外します。]

+
|===


 a| 
image::../media/legend_icon_01.png[凡例アイコン01]
| バッテリリリースタブ 


 a| 
image::../media/legend_icon_02.png[凡例アイコン 02]
| バッテリ電源コネクタ 
|===


. バッテリを交換用コントローラキャニスターに移動します。
+
.. バッテリを金属板の側壁の保持ブラケットに合わせますが、接続しないでください。残りのコンポーネントを交換用コントローラキャニスターに移動したら、プラグを差し込みます。


. 交換用コントローラにDIMMが事前に取り付けられている場合は、に進みます。 <<step7_install_battery,手順7：バッテリを取り付ける>>。それ以外の場合は、次の手順に進みます。




== 手順6：DIMMを移動する

障害のあるコントローラキャニスターからDIMMを取り外し、交換用コントローラキャニスターに取り付けます。

.手順
. コントローラキャニスターでDIMMの場所を確認します。
+

NOTE: DIMMを交換用コントローラキャニスターの同じ場所に正しい向きで挿入できるように、ソケット内のDIMMの場所をメモします。
障害のあるコントローラキャニスターからDIMMを取り外します。

+
.. DIMMの両側にある2つのツメをゆっくり押し開いて、DIMMをスロットから外します。
+
DIMMが少し上に回転します。

.. DIMMを所定の位置まで回転させ、ソケットから引き出します。
+

NOTE: DIMM 回路基板のコンポーネントに力が加わらないように、 DIMM の両端を慎重に持ちます。

+
image::../media/drw_E4000_replace_dimms_IEOPS-865.png[DIMMを取り外します。]

+
|===


 a| 
image::../media/legend_icon_01.png[凡例アイコン01]
| DIMM のツメ 


 a| 
image::../media/legend_icon_02.png[凡例アイコン 02]
| DIMM 
|===


. 交換用コントローラキャニスターにバッテリが接続されていないことを確認します。
. DIMMは、障害コントローラと同じ場所に交換用コントローラに取り付けます。
+
.. DIMM の両端のノッチにツメがかかるまで、 DIMM の上部を慎重にしっかり押し込みます。
+
DIMM のスロットへの挿入にはある程度の力が必要です。簡単に挿入できない場合は、 DIMM をスロットに正しく合わせてから再度挿入してください。

+

NOTE: DIMM がスロットにまっすぐ差し込まれていることを目で確認してください。



. 他のDIMMについても同じ手順を繰り返します。
. 交換用コントローラにバッテリが装着されている場合は、に進みます。 <<step8_replace_controller,手順8：コントローラを交換する>>。それ以外の場合は、次の手順に進みます。




== 手順7：バッテリを取り付ける

交換用コントローラキャニスターにバッテリを取り付けます。

.手順
. バッテリプラグをコントローラキャニスターのソケットに再度接続します。
+
プラグがマザーボードのバッテリソケットに固定されていることを確認します。

. バッテリを金属板の側壁の保持ブラケットに合わせます。
. バッテリラッチがカチッという音がして側壁の開口部に収まるまで、バッテリパックを下にスライドさせます。
. コントローラキャニスターのカバーを再度取り付け、所定の位置にロックします。




== 手順8：コントローラを交換する

交換用コントローラを設置し、ノードがグリッドに再参加したことを確認します。

.手順
. 交換用コントローラをアプライアンスに取り付けます。
+
.. 取り外し可能なカバーが下になるようにコントローラを裏返します。
.. カムハンドルを開いた状態でコントローラをスライドし、アプライアンスに最後まで挿入します。
.. カムハンドルを左側に動かして、コントローラを所定の位置にロックします。
.. ケーブルを交換します。
.. コントローラシェルフの電源をオンにします。
.. E4000コントローラが再起動するまで待ちます。
.. 交換用コントローラに IP アドレスを割り当てる方法を決定します。
+

NOTE: 交換用コントローラにIPアドレスを割り当てる手順は、管理ポートを接続したネットワークにDHCPサーバがあるかどうか、およびすべてのドライブがセキュリティ保護されているかどうかによって異なります。

+
管理ポート 1 が DHCP サーバがあるネットワークに接続されている場合は、新しいコントローラの IP アドレスが DHCP サーバから取得されます。この値は、元のコントローラの IP アドレスと異なる場合があります。



. ストレージアレイにセキュアドライブがある場合は、ドライブセキュリティキーをインポートします。それ以外の場合は、次の手順に進みます。すべてのセキュアドライブを含むストレージアレイ、またはセキュアドライブとセキュアでないドライブが混在しているストレージアレイの場合は、以下の該当する手順に従います。
+

NOTE: セキュアでないドライブ _ 未割り当てのドライブ、グローバルホットスペアドライブ、またはドライブセキュリティ機能で保護されていないボリュームグループまたはプールに含まれるドライブです。セキュアドライブとは、ドライブセキュリティを使用してセキュアなボリュームグループまたはディスクプールに属するドライブを割り当てたものです。

+
** * セキュリティ保護されたドライブのみ ( セキュリティ保護されていないドライブは不要 )* ：
+
... ストレージアレイのコマンドラインインターフェイス（ CLI ）にアクセスします。CLIの詳細については、を参照してください。 https://docs.netapp.com/us-en/e-series-cli/index.html["Eシリーズのドキュメント"]。
... 該当するシンプレックスNVSRAMをコントローラにロードします。
+
例： `download storageArray NVSRAM file=\"N4000-881834-SG4.dlp\" forceDownload=TRUE;`

... シンプレックスNVSRAMをロードしたあとに、コントローラが「最適」*であることを確認します。
... 外部セキュリティキー管理を使用する場合は、 https://docs.netapp.com/us-en/e-series/upgrade-controllers/upgrade-unlock-drives-task.html#external-key-management["コントローラで外部キー管理を設定する"]。
... 内部セキュリティキー管理を使用している場合は、次のコマンドを入力してセキュリティキーをインポートします。
+
[listing]
----
import storageArray securityKey file="C:/file.slk"
passPhrase="passPhrase";
----
+
ここで、

+
**** `C:/file.slk` は、ドライブセキュリティキーのディレクトリの場所と名前です。
**** `passPhrase` は、セキュリティキーがインポートされてコントローラがリブートされ、新しいコントローラでストレージアレイに保存されている設定が適用されたあとにファイルのロックを解除するために必要なパスフレーズです。


... 次の手順に進み、新しいコントローラが「最適」になっていることを確認します。


** * 安全なドライブと安全でないドライブの混在 * ：
+
... サポートバンドルを収集して、ストレージアレイプロファイルを開きます。
... セキュアでないドライブの場所をすべて検出して記録します。これらの場所はサポートバンドルに含まれています。
... システムの電源を切ります。
... セキュアでないドライブを取り外します。
... コントローラを交換してください。
... システムの電源を入れ、デジタル表示ディスプレイにトレイ番号が表示されるまで待ちます。
... SANtricityシステムマネージャで、*[設定]>[システム]を選択します。
... [ セキュリティキーの管理 ] セクションで、 [ キーの作成 / 変更 *] を選択して新しいセキュリティキーを作成します。
... 保存したセキュリティキーをインポートするには、「 Secure Drives のロック解除」を選択します。
... を実行します `set allDrives nativeState` CLIコマンド。
... コントローラが自動的にリブートされます。
... コントローラがブートし、デジタル表示ディスプレイにトレイ番号または L5 が点滅するまで待ちます。
... システムの電源を切ります。
... セキュアでないドライブを取り付け直します。
... SANtricity システムマネージャを使用してコントローラをリセットします。
... システムの電源を入れ、デジタル表示ディスプレイにトレイ番号が表示されるまで待ちます。
... 次の手順に進み、新しいコントローラが「最適」になっていることを確認します。




. この手順の実行中にアプライアンスをメンテナンスモードにした場合は、アプライアンスを通常の動作モードに戻します。StorageGRID アプライアンス・インストーラから、 *Advanced*>* Reboot Controller* を選択し、 * Reboot into StorageGRID * を選択します。
+
image::../media/reboot_controller_from_maintenance_mode.png[コントローラをメンテナンスモードでリブートします]

. リブート中に、ノードのステータスを監視して、ノードが再びグリッドに参加したタイミングを確認します。
+
アプライアンスがリブートし、グリッドに再度参加します。このプロセスには最大20分かかることがあります。

. リブートが完了し、ノードが再びグリッドに参加したことを確認します。Grid Managerで、[Nodes]ページのステータスが[Normal]（緑のチェックマークアイコン）になっていることを確認します image:../media/icon_alert_green_checkmark.png["緑のチェックマーク"] （ノード名の左側）に表示されます。これは、アクティブなアラートがなく、ノードがグリッドに接続されていることを示します。
+
image::../media/nodes_menu.png[アプライアンスノードがグリッドに再参加しました]

. SANtricity System Manager で、新しいコントローラが「最適」になっていることを確認します。
+
.. 「 * ハードウェア * 」を選択します。
.. コントローラシェルフの場合は、 * Show back of shelf * を選択します。
.. 交換したコントローラキャニスターを選択します。
.. 「 * 表示設定 * 」を選択します。
.. コントローラの * Status * が最適な状態であることを確認します。
.. ステータスが「最適」でない場合は、コントローラを強調表示し、「オンラインにする」を選択します。


. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
.. *サポート›サポートセンター›診断*を選択します。
.. 「サポートデータの収集」を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。





.次の手順
部品の交換後、障害のある部品は、キットに付属する RMA 指示書に従ってネットアップに返却してください。を参照してください https://mysupport.netapp.com/site/info/rma["パーツの返品と交換"^] 詳細については、を参照してください。
